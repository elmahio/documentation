name: ci
on:
  push:
    branches:
      - main
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.x
      #- uses: actions/setup-node@v1
      #  with:
      #    node-version: 12.16.0
      #- run: npm install
      #- run: gulp min
      #- name: Upload source map to elmah.io
      #  uses: elmahio/github-upload-source-map-action@v1
      #  with:
      #    apiKey: ${{ secrets.ELMAH_IO_API_KEY }}
      #    logId: ${{ secrets.ELMAH_IO_LOG_ID }}
      #    path: '/assets/js/main.min.js'
      #    sourceMap: './mkdocs_bs4/assets/js/main.min.js.map'
      #    minifiedJavaScript: './mkdocs_bs4/assets/js/main.min.js'
      #- name: Remove the .map file
      #  run: rm ./mkdocs_bs4/assets/js/main.min.js.map
      - run: pip install mkdocs
      - run: pip install pymdown-extensions
      - run: pip install markdown-fenced-code-tabs
      - run: pip install mkdocs-redirects
      - run: pip install jinja2==3.0.0
      - run: pip3 install mkdocs-git-revision-date-localized-plugin
      - run: pip install mkdocs-minify-plugin
      - name: Update mkdocs.yml - production TRUE
        run: sed -i 's/production:\ false/production:\ true/' mkdocs.yml
      - name: Update mkdocs.yml - git-revision-date-localized ENABLED
        run: sed -i 's/enabled:\ false/enabled:\ true/' mkdocs.yml
      - name: Update mkdocs.yml - minify_html TRUE
        run: sed -i 's/minify_html:\ false/minify_html:\ true/' mkdocs.yml
      - name: Update mkdocs.yml - minify_js TRUE
        run: sed -i 's/minify_js:\ false/minify_js:\ true/' mkdocs.yml
      - name: Update mkdocs.yml - minify_css TRUE
        run: sed -i 's/minify_css:\ false/minify_css:\ true/' mkdocs.yml
      - name: Replace BUILD_NUMBER main.html & 404.html
        run: |
          sed -i 's/BUILD_NUMBER/${{github.run_number}}/g' ./mkdocs_bs4/main.html
          sed -i 's/BUILD_NUMBER/${{github.run_number}}/g' ./mkdocs_bs4/404.html
      - run: mkdocs gh-deploy --force --clean --verbose
      - name: Create Deployment on elmah.io
        uses: elmahio/github-create-deployment-action@v1
        with:
          apiKey: ${{ secrets.ELMAH_IO_API_KEY }}
          version: ${{ github.run_number }}
          description: ${{ github.event.head_commit.message }}
          userName: ${{ github.actor }}
          logId: ${{ secrets.ELMAH_IO_LOG_ID }}
